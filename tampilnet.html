<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Data Barang</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    .rekap { display: flex; justify-content: space-around; margin: 20px 0; }
    .card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); flex:1; margin:0 10px; text-align: center; }
    #filters { margin: 20px 0; text-align: center; }
    #filters select, #filters button { margin: 0 5px; padding: 5px; }
    canvas { background: white; border-radius: 8px; padding: 10px; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #4CAF50; color: white; }
  </style>
</head>
<body>
  <h1>ðŸ“Š Dashboard Data Barang</h1>

  <!-- Filter -->
  <div id="filters">
    <label>Kecamatan:
      <select id="filterKecamatan"><option value="">Semua</option></select>
    </label>
    <label>Tahun:
      <select id="filterTahun"><option value="">Semua</option></select>
    </label>
    <label>Jenis Barang:
      <select id="filterBarang"><option value="">Semua</option></select>
    </label>
    <button onclick="applyFilters()">Terapkan</button>
  </div>

  <!-- Rekap -->
  <div class="rekap">
    <div class="card"><h3 id="totalBarang">0</h3><p>Total Barang</p></div>
    <div class="card"><h3 id="totalSekolah">0</h3><p>Total Sekolah</p></div>
    <div class="card"><h3 id="totalKecamatan">0</h3><p>Total Kecamatan</p></div>
  </div>

  <!-- Grafik -->
  <canvas id="chartKecamatan" height="100"></canvas>
  <canvas id="chartBarang" height="100"></canvas>

  <!-- Tabel -->
  <table id="tabelSekolah">
    <thead>
      <tr>
        <th>Kecamatan</th>
        <th>Sekolah</th>
        <th>Barang</th>
        <th>Jumlah</th>
        <th>Tahun</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const sources = {
  "Banawa": "https://docs.google.com/spreadsheets/d/e/2PACX-1vSCAaRZ9atAiEb-BvMChP_3Wq6wtmUUlNiTWVtwzh7r9KX5sRRZpq5WppSrSebym8z6-qI3zfWQOTNu/pub?gid=0&single=true&output=csv",
  "Banawa Tengah": "https://docs.google.com/spreadsheets/d/e/2PACX-1vToEAn2MqanfOGSKsDsV0cfGeXt6mJhf7DPEzgFeBl8GQkrbzd4iFuM3tRwyo_wV6m9PlxjQ-9Z0QhC/pub?gid=0&single=true&output=csv",
  "Banawa Selatan": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQwth8ToDewTdvfvhlYuywOolNFwvc6eA4wer_OGKgNk-FoDvIQaHthsQHtMiis3cAsj4AnLzYKXG9p/pub?gid=0&single=true&output=csv",
  "Rio Pakava": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQX_Z6U7nanrMlPxL8N1m40jkFiMAHCIbZQA_iljNj3QZ8Z5FGMTAzYBbAC_D9Xy2PT3fUf0LL0n7F/pub?gid=0&single=true&output=csv",
  "Pinembani": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQcReqyQvHT1K094wmITv7oL1dpVGSA7K139SmWIlNcJzVItMNLyCz0Q-u5Sg1H1QXs1R9mNyL73SBj/pub?gid=0&single=true&output=csv",
  "Tanantovea": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQGT-OgwESxefxs2tnW_OoIZk2c76I6fKSqaQUoibT4B_-QVNtPPMZSDnEaawJRGaLB3tP-ChoDugoi/pub?gid=0&single=true&output=csv",
  "Labuan": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQaDzmjVhNzRnMTJWg2JkvR1DYTiDSl2S6-MisvcSFD9P7MB2rVxA2zRgS0Rd0-f-xpIt1db1O1ppXx/pub?gid=0&single=true&output=csv",
  "Sindue": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRnq_cellwa56qRzTfYLpUxHoLxpiQOBBmiAUCkdeJK8-tLMVawW9BLrWUA_Q_kMswogfdZlmWjHGQT/pub?gid=0&single=true&output=csv",
  "Sindue Tombusabora": "https://docs.google.com/spreadsheets/d/e/2PACX-1vS11oEXPUetCOBorbbFNejuPEMsw4L8GYp-ETIbncBOgBfOtvLruTC82mUd-vxb7fj6sXopy16axzXi/pub?gid=0&single=true&output=csv",
  "Sindue Tobata": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQg_48k1uaVtdc2v4UgVwn3PBxAFP4gfEhIR_OCBKVOcSrHRUYS1jPO1P1E1qnHGM_WcqDB2TFkE74t/pub?gid=0&single=true&output=csv",
  "Sirenja": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQpFtH1q7lOez0grPXzNd1AAU93FZQZPSCyVrT4RneIumbxU0CbvukEfotyjhq01gYVLhK0_WblO_HO/pub?gid=0&single=true&output=csv",
  "Balaesang": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQevpAs3bjvgOzZDc8uq2PoebzqXVEFCvggoqJvn8AO-d1M0BCI0k7QYKB9hTgymfUIXx68oVR27IV/pub?gid=0&single=true&output=csv",
  "Balaesang Tanjung": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQljJh_fOmCwjRVlTt5k8WxpN3TzaSyhWDXNnkDjI8hm62x1jdE41mXNENd2iGUueNyuXJuLa4jpoF6/pub?gid=0&single=true&output=csv",
  "Dampelas": "https://docs.google.com/spreadsheets/d/e/2PACX-1vTTIi8ZSNx9-MetxVLFAxiS4MeBiFOuOeYbe4_Bf9EEQ2btWYDfIY15B6r_tBg33l0AFATRQrdoQyMq/pub?gid=0&single=true&output=csv",
  "Sojol": "https://docs.google.com/spreadsheets/d/e/2PACX-1vR_M8W7eNSRgJiDs-lU0zBDAT2OEAN6J1g1G9UvgreUf7GS0_Q987XsgzYdDESWAu_P86BezxKn6nJl/pub?gid=0&single=true&output=csv",
  "Sojol Utara": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRJAkrtkVPBLcUmM8OsByQDfndFGv-6MetoMsB_DGoqimZQGcAg9Lxe_glv_qAJoVXoY9TCHdnCDa6Y/pub?gid=0&single=true&output=csv"
};

let allData = [];
let chartKec, chartBarang;

async function loadAllData(){
  allData = [];
  for(const [kec,url] of Object.entries(sources)){
    const res = await fetch(url);
    const csv = await res.text();
    const rows = Papa.parse(csv,{header:true,skipEmptyLines:true}).data;
    rows.forEach(r=>{
      r.kecamatan=kec;
      r.jumlah=parseInt(r.jumlah)||0;
    });
    allData.push(...rows);
  }
  populateFilters();
  updateData(allData);
}

function populateFilters(){
  const kecSel=document.getElementById("filterKecamatan");
  const thnSel=document.getElementById("filterTahun");
  const brgSel=document.getElementById("filterBarang");
  let kecSet=new Set(), thnSet=new Set(), brgSet=new Set();
  allData.forEach(r=>{
    kecSet.add(r.kecamatan);
    if(r.tahun) thnSet.add(r.tahun);
    if(r.barang) brgSet.add(r.barang);
  });
  kecSel.innerHTML='<option value="">Semua</option>';
  thnSel.innerHTML='<option value="">Semua</option>';
  brgSel.innerHTML='<option value="">Semua</option>';
  kecSet.forEach(k=>kecSel.innerHTML+=`<option>${k}</option>`);
  thnSet.forEach(t=>thnSel.innerHTML+=`<option>${t}</option>`);
  brgSet.forEach(b=>brgSel.innerHTML+=`<option>${b}</option>`);
}

function applyFilters(){
  const fKec=document.getElementById("filterKecamatan").value;
  const fThn=document.getElementById("filterTahun").value;
  const fBrg=document.getElementById("filterBarang").value;
  const filtered=allData.filter(r=>
    (fKec===""||r.kecamatan===fKec)&&
    (fThn===""||r.tahun==fThn)&&
    (fBrg===""||r.barang===fBrg)
  );
  updateData(filtered);
}

function updateData(data){
  // Rekap
  document.getElementById("totalBarang").textContent=data.reduce((a,b)=>a+b.jumlah,0);
  document.getElementById("totalSekolah").textContent=new Set(data.map(r=>r.sekolah)).size;
  document.getElementById("totalKecamatan").textContent=new Set(data.map(r=>r.kecamatan)).size;

  // Grafik kecamatan
  const kecCount={};
  data.forEach(r=>{kecCount[r.kecamatan]=(kecCount[r.kecamatan]||0)+r.jumlah;});
  const ctx1=document.getElementById("chartKecamatan").getContext("2d");
  if(chartKec) chartKec.destroy();
  chartKec=new Chart(ctx1,{type:"bar",data:{
    labels:Object.keys(kecCount),
    datasets:[{label:"Jumlah Barang",data:Object.values(kecCount)}]
  }});

  // Grafik barang
  const brgCount={};
  data.forEach(r=>{brgCount[r.barang]=(brgCount[r.barang]||0)+r.jumlah;});
  const ctx2=document.getElementById("chartBarang").getContext("2d");
  if(chartBarang) chartBarang.destroy();
  chartBarang=new Chart(ctx2,{type:"pie",data:{
    labels:Object.keys(brgCount),
    datasets:[{data:Object.values(brgCount)}]
  }});

  // Tabel
  const tbody=document.querySelector("#tabelSekolah tbody");
  tbody.innerHTML="";
  data.forEach(r=>{
    tbody.innerHTML+=`<tr>
      <td>${r.kecamatan}</td>
      <td>${r.sekolah||"-"}</td>
      <td>${r.barang||"-"}</td>
      <td>${r.jumlah||0}</td>
      <td>${r.tahun||"-"}</td>
    </tr>`;
  });
}

loadAllData();
</script>
</body>
</html>
